# Face Detection In Python

"It's fascinating what a computer can do given a couple of clear and concise instructions by a competent programmer." -- 0x23212f

### OpenCV

OpenCV is the most popular computer vision (hence the 'CV' in the name) library. OpenCV uses machine learning to search for faces within a picture. For a dumb turing machine to recognise faces in an image file would imply recognising all the characteristics/traits of a human face by finding recurring patterns/features that need to be matched.

An algorithm that breaks the task into smaller, easier solvable tasks, called a classifier, is required for this.

But this becomes very computationally intensive since that are 6000, or more classifiers for a face to be detected (within error limits, ofc). To detect faces, the algorithm starts at top-left and moves down across small blocks, looking at each block and consistently asking "Is this a face or part of a face?"..

To get around this, OpenCV uses *cascades* (*Definition: A waterfall or series of waterfalls.*). OpenCV breaks the problem into multiple blocks. To test a block, a simple test is done which when passed goes to a more extensive test and so on. A face is *detected* if all stages pass. This way, all 6000 features are not tested on each block, saving a lot of valuable computation time.

### Cascades in practise

The cascades themselves are a bunch of XML that contain OpenCV data to detect objects. You initialize your code with the cascade you want and it does the work for you.

OpenCV comes with numerous built-in cascades.

### Installing OpenCV

```sh
$ sudo apt-get install build-essential
$ sudo apt-get install cmake git libgtk2.0-dev pkg-config libavcodec-dev libavformat-dev libswscale-dev
$ sudo apt-get install python-dev python-numpy libtbb2 libtbb-dev libjpeg-dev libpng-dev libtiff-dev libjasper-dev libdc1394-22-dev
```

Get the source for [your os](http://opencv.org/downloads.html).

```sh
$ unzip opencv-2.4.13.zip
```
Make a directory to store Makefiles, project files, object files and binary files that are generated by *cmake*.

```sh
$ mkdir cmake_bin
$ cd cmake_bin
$ cmake ..
$ Make
$ sudo make install
```

**Now keep your fingers crossed, go make yourself a couple of cups of coffee, sacrifice a few animals and pray to at least one pagan deity.**

### Haar-like Features

Since we'll be using a haar cascade, it might be cool to understand what haar-like features are.

All human faces share some similar properties. These regularities may be matched using *Haar Features*.

Few properties common to human faces that are used by the Viola-Jones Object Detection Framework:
- Eye region is darker than the upper-cheeks
- Nose bridge is brighter than the eyes
- Location and size: eyes, mouth, bridge of nose
- Value: Oriented gradients of pixel intensities

An image representation called the integral image, that evaluates rectangular features in *constant* time, helps maintain a speed advantage.

*Integral Image* - A summed area table is a data structure and algorithm for quickly + efficiently generating the sum of values in a rectangular subset of a grid. This is known as Integral Image in DIP.

### Documented Code to Detect Faces in Images

````python
import sys, cv2

# get command-line arguments
imagePath = sys.argv[1]
cascadePath = sys.argv[2]

# create haar cascade
faceCascade = cv2.CascadeClassifier(cascadePath)

# read the image
image = cv2.imread(imagePath)

# convert image to grayscale. lot of opencv operations are done in grayscale.
gray = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY)

# this is where the faces are being detected
# detectMultiScale detects objects. we're calling it on the faces cascade
# parameters:
# gray -> the grayscale of the input image object
# scaleFactor=1.1 -> compensates for different sized faces
# minNeighbors=5 -> how many objects are detected near current to declare face found
# minSize=(30,30) -> gives size of each window

faces = faceCascade.detectMultiScale(
	gray,
	scaleFactor=1.1,
	minNeighbors=5,
	minSize=(30,30),
	flags = cv2.cv.CV_HAAR_SCALE_IMAGE
)

print "Found {0} faces!".format(len(faces))

# draw rectangle around detected faces
for (x, y, w, h) in faces:
	cv2.rectangle(image, (x,y), (x+w, y+h), (0, 255, 0), 2)

# display rectangled-image
cv2.imshow("Faces found", image)

# wait for user to press key
cv2.waitKey(0)
```
